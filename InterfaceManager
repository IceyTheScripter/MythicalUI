-- ========================
-- Mythical InterfaceManager
-- ========================
local HttpService = game:GetService("HttpService")

local InterfaceManager = {} do
    InterfaceManager.Folder = "MythicalScriptHub"
    InterfaceManager.Settings = {
        Theme = "Purple Mystic"
    }
    InterfaceManager.Library = nil

    function InterfaceManager:SetFolder(folder)
        self.Folder = folder
        self:BuildFolderTree()
    end

    function InterfaceManager:SetLibrary(library)
        self.Library = library
    end

    function InterfaceManager:BuildFolderTree()
        local paths = {}
        local parts = self.Folder:split("/")
        for idx = 1, #parts do
            table.insert(paths, table.concat(parts, "/", 1, idx))
        end
        table.insert(paths, self.Folder .. "/interface")

        for _, path in next, paths do
            if not isfolder(path) then
                makefolder(path)
            end
        end
    end

    function InterfaceManager:SaveSettings()
        writefile(self.Folder .. "/interface.json", HttpService:JSONEncode(self.Settings))
    end

    function InterfaceManager:LoadSettings()
        local path = self.Folder .. "/interface.json"
        if isfile(path) then
            local data = readfile(path)
            local success, decoded = pcall(HttpService.JSONDecode, HttpService, data)
            if success and decoded then
                for key, value in next, decoded do
                    self.Settings[key] = value
                    if key == "Theme" and self.Library then
                        self.Library:SetTheme(value)
                    end
                end
            end
        end
    end

    -- Build interface section automatically
    function InterfaceManager:BuildInterfaceSection(tab)
        assert(self.Library, "InterfaceManager.Library must be set!")
        self:LoadSettings()

        local themeDropdown = tab:AddDropdown("InterfaceTheme", {
            Title = "Theme",
            Values = self.Library:GetThemes(),
            Default = self.Settings.Theme,
            Callback = function(value)
                self.Library:SetTheme(value)
                self.Settings.Theme = value
                self:SaveSettings()
            end
        })

        themeDropdown:SetValue(self.Settings.Theme)
    end
end

return InterfaceManager
