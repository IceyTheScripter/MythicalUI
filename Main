-- MYTHICAL UI LIBRARY FIXED
local MythicalUI = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

-- THEME (kept only 1 for simplicity, can add others)
local currentTheme = {
	primary = Color3.fromRGB(138, 43, 226),
	secondary = Color3.fromRGB(186, 85, 211),
	background = Color3.fromRGB(15, 15, 20),
	topbar = Color3.fromRGB(20, 20, 28),
	element = Color3.fromRGB(25, 25, 35),
	text = Color3.fromRGB(255, 255, 255),
	textDim = Color3.fromRGB(180, 180, 200),
	accent = Color3.fromRGB(138, 43, 226),
	particleColor = Color3.fromRGB(138, 43, 226)
}

local function playSound(soundId, volume, pitch)
	local sound = Instance.new("Sound")
	sound.SoundId = soundId
	sound.Volume = volume or 0.5
	sound.PlaybackSpeed = pitch or 1
	sound.Parent = game:GetService("SoundService")
	sound:Play()
	game:GetService("Debris"):AddItem(sound, 2)
end

local function tween(obj, props, duration, style, dir)
	local tweenInfo = TweenInfo.new(duration or 0.3, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out)
	local t = TweenService:Create(obj, tweenInfo, props)
	t:Play()
	return t
end

function MythicalUI:CreateWindow(config)
	local Window = {}
	Window.Tabs = {}
	Window.CurrentTab = nil
	
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "MythicalUI"
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	if gethui then
		screenGui.Parent = gethui()
	elseif syn and syn.protect_gui then
		syn.protect_gui(screenGui)
		screenGui.Parent = CoreGui
	else
		screenGui.Parent = CoreGui
	end
	
	local mainFrame = Instance.new("Frame")
	mainFrame.Name = "MainFrame"
	mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
	mainFrame.Position = UDim2.new(0.5,0,0.5,0)
	mainFrame.Size = UDim2.fromScale(0.45,0.65)
	mainFrame.SizeConstraint = Enum.SizeConstraint.RelativeXX
	mainFrame.BackgroundColor3 = currentTheme.background
	mainFrame.BorderSizePixel = 0
	mainFrame.ClipsDescendants = true
	mainFrame.Parent = screenGui
	
	local sizeConstraint = Instance.new("UISizeConstraint")
	sizeConstraint.MinSize = Vector2.new(580,460)
	sizeConstraint.MaxSize = Vector2.new(900,700)
	sizeConstraint.Parent = mainFrame
	
	local mainCorner = Instance.new("UICorner")
	mainCorner.CornerRadius = UDim.new(0,12)
	mainCorner.Parent = mainFrame
	
	local stroke = Instance.new("UIStroke")
	stroke.Color = currentTheme.primary
	stroke.Thickness = 2
	stroke.Transparency = 0.5
	stroke.Parent = mainFrame
	
	-- Top Bar
	local topBar = Instance.new("Frame")
	topBar.Name = "TopBar"
	topBar.Size = UDim2.new(1,0,0,45)
	topBar.BackgroundColor3 = currentTheme.topbar
	topBar.BorderSizePixel = 0
	topBar.ZIndex = 5
	topBar.Parent = mainFrame
	
	local topCorner = Instance.new("UICorner")
	topCorner.CornerRadius = UDim.new(0,12)
	topCorner.Parent = topBar
	
	local title = Instance.new("TextLabel")
	title.Name = "Title"
	title.Size = UDim2.new(0,200,1,0)
	title.Position = UDim2.new(0,15,0,0)
	title.BackgroundTransparency = 1
	title.Text = config.Title or "Mythical UI"
	title.TextColor3 = currentTheme.text
	title.TextSize = 18
	title.Font = Enum.Font.GothamBold
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.ZIndex = 6
	title.Parent = topBar
	
	local subtitle = Instance.new("TextLabel")
	subtitle.Name = "Subtitle"
	subtitle.Size = UDim2.new(0,200,1,0)
	subtitle.Position = UDim2.new(0,120,0,0)
	subtitle.BackgroundTransparency = 1
	subtitle.Text = config.SubTitle or "v1.0"
	subtitle.TextColor3 = currentTheme.textDim
	subtitle.TextSize = 14
	subtitle.Font = Enum.Font.Gotham
	subtitle.TextXAlignment = Enum.TextXAlignment.Left
	subtitle.ZIndex = 6
	subtitle.Parent = topBar
	
	local function createButtonIconButton(text,sizeX,posX,callback)
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(0,sizeX,0,35)
		btn.Position = UDim2.new(1,posX,0.5,0)
		btn.AnchorPoint = Vector2.new(0,0.5)
		btn.BackgroundColor3 = currentTheme.element
		btn.BorderSizePixel = 0
		btn.Text = text
		btn.TextColor3 = currentTheme.text
		btn.Font = Enum.Font.GothamBold
		btn.TextSize = 20
		btn.ZIndex = 6
		btn.Parent = topBar
		
		local corner = Instance.new("UICorner")
		corner.CornerRadius = UDim.new(0,8)
		corner.Parent = btn
		
		btn.MouseButton1Click:Connect(callback)
		return btn
	end
	
	local closeBtn = createButtonIconButton("×",35,-40,function()
		tween(mainFrame,{Size=UDim2.fromScale(0,0)},0.3)
		task.wait(0.3)
		screenGui:Destroy()
	end)
	
	local isMinimized = false
	local minimizeBtn = createButtonIconButton("−",35,-80,function()
		isMinimized = not isMinimized
		if isMinimized then
			tween(mainFrame,{Size=UDim2.new(0,250,0,50)},0.3)
			tabContainer.Visible = false
			contentContainer.Visible = false
		else
			tween(mainFrame,{Size=UDim2.fromScale(0.45,0.65)},0.3)
			tabContainer.Visible = true
			contentContainer.Visible = true
		end
	end)
	
	-- Dragging
	local dragging, dragInput, dragStart, startPos
	topBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = mainFrame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	topBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			mainFrame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)
	
	-- Tab Container
	local tabContainer = Instance.new("Frame")
	tabContainer.Name = "TabContainer"
	tabContainer.Size = UDim2.new(0,config.TabWidth or 160,1, -50)
	tabContainer.Position = UDim2.new(0,5,0,50)
	tabContainer.BackgroundTransparency = 1
	tabContainer.ZIndex = 3
	tabContainer.Parent = mainFrame
	
	local tabList = Instance.new("UIListLayout")
	tabList.SortOrder = Enum.SortOrder.LayoutOrder
	tabList.Padding = UDim.new(0,5)
	tabList.Parent = tabContainer
	
	-- Content Container
	local contentContainer = Instance.new("Frame")
	contentContainer.Name = "ContentContainer"
	contentContainer.Size = UDim2.new(1,-(config.TabWidth or 160)-15,1,-60)
	contentContainer.Position = UDim2.new(0,(config.TabWidth or 160)+10,0,55)
	contentContainer.BackgroundTransparency = 1
	contentContainer.ClipsDescendants = true
	contentContainer.ZIndex = 3
	contentContainer.Parent = mainFrame
	
	-- ADD TAB FUNCTION
	function Window:AddTab(tabConfig)
		local Tab = {}
		Tab.Elements = {}
		Tab.Name = tabConfig.Title or "Tab"
		
		local tabButton = Instance.new("TextButton")
		tabButton.Size = UDim2.new(1,0,0,40)
		tabButton.BackgroundColor3 = currentTheme.element
		tabButton.BorderSizePixel = 0
		tabButton.Text = "  "..Tab.Name
		tabButton.TextColor3 = currentTheme.textDim
		tabButton.TextSize = 15
		tabButton.Font = Enum.Font.GothamSemibold
		tabButton.TextXAlignment = Enum.TextXAlignment.Left
		tabButton.ZIndex = 4
		tabButton.Parent = tabContainer
		
		local tabCorner = Instance.new("UICorner")
		tabCorner.CornerRadius = UDim.new(0,8)
		tabCorner.Parent = tabButton
		
		local tabContent = Instance.new("ScrollingFrame")
		tabContent.Size = UDim2.new(1,0,1,0)
		tabContent.Position = UDim2.new(0,0,0,0)
		tabContent.BackgroundTransparency = 1
		tabContent.BorderSizePixel = 0
		tabContent.ScrollBarThickness = 4
		tabContent.ScrollBarImageColor3 = currentTheme.primary
		tabContent.CanvasSize = UDim2.new(0,0,0,0)
		tabContent.Visible = false
		tabContent.ZIndex = 4
		tabContent.Parent = contentContainer
		
		local contentList = Instance.new("UIListLayout")
		contentList.SortOrder = Enum.SortOrder.LayoutOrder
		contentList.Padding = UDim.new(0,8)
		contentList.Parent = tabContent
		
		local contentPadding = Instance.new("UIPadding")
		contentPadding.PaddingTop = UDim.new(0,5)
		contentPadding.PaddingLeft = UDim.new(0,5)
		contentPadding.PaddingRight = UDim.new(0,5)
		contentPadding.PaddingBottom = UDim.new(0,5)
		contentPadding.Parent = tabContent
		
		contentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			tabContent.CanvasSize = UDim2.new(0,0,0,contentList.AbsoluteContentSize.Y+10)
		end)
		
		tabButton.MouseButton1Click:Connect(function()
			for name, t in pairs(Window.Tabs) do
				t.Button.BackgroundColor3 = currentTheme.element
				t.Button.TextColor3 = currentTheme.textDim
				t.Content.Visible = false
			end
			tabButton.BackgroundColor3 = currentTheme.primary
			tabButton.TextColor3 = currentTheme.text
			tabContent.Visible = true
			Window.CurrentTab = Tab.Name
		end)
		
		Window.Tabs[Tab.Name] = {Button=tabButton,Content=tabContent,Tab=Tab}
		return Tab
	end
	
	return Window
end

return MythicalUI
